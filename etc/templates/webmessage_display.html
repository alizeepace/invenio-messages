{#
## This file is part of Invenio.
## Copyright (C) 2012 CERN.
##
## Invenio is free software; you can redistribute it and/or
## modify it under the terms of the GNU General Public License as
## published by the Free Software Foundation; either version 2 of the
## License, or (at your option) any later version.
##
## Invenio is distributed in the hope that it will be useful, but
## WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
## General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with Invenio; if not, write to the Free Software Foundation, Inc.,
## 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.
#}
{% extends "page.html" %}
{% set title = _("Your Messages") %}
{% set personalize_selected = True %}
{% block body %}
{% if not no_quota %}
    {% set ratio = 1.0 * nb_messages / config.CFG_WEBMESSAGE_MAX_NB_OF_MESSAGES %}
    {{ _("Quota used: %(x_nb_used)i messages out of max. %(x_nb_total)i")|format(x_nb_used=nb_messages, x_nb_total=config.CFG_WEBMESSAGE_MAX_NB_OF_MESSAGES) }}<br />
    <div class="quotabox"><div class="quotabar" style="width:{{ ratio * 200|int }}px"></div></div>
{% endif %}
<table class="mailbox">
  <thead class="mailboxheader">
    <tr class="inboxheader">
      <td>{{ _("Subject") }}</td>
      <td>{{ _("Sender") }}</td>
      <td>{{ _("Date") }}</td>
      <td>{{ _("Action") }}</td>
    </tr>
  </thead>
  <tfoot>
    <tr style="height:0px;">
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tfoot>
  <tbody class="mailboxbody">
    {% if not messages %}
        <tr class="mailboxrecord" style="height: 100px;">
        <td colspan="4" style="text-align: center;">
            <b>{{ _("No messages") }}</b>
        </td>
        </tr>
    {% else %}
        {% for m in messages %}
            {% if m.status == config.CFG_WEBMESSAGE_STATUS_CODE['NEW'] %}
                {% set status_style = ' style="font-weight:bold"' %}
            {% endif %}
            <tr class="mailboxrecord">
                <td {{ status_style }}><a href="{{ url_for('.display_msg', msgid=m.id) }}">
                {% if m.subject %}
                    {{ m.subject }}
                {% else %}
                    {{ _("No subject") }}
                {% endif %}
                </a></td>
                <td>{{ m.user_from.nickname }}</td>
                <td>{{ m.sent_date|invenio_format_date }}</td>
                <td><a href="{{url_for('.delete', msgid=m.id) }}">{{ _("Delete") }}</a></td>
            </tr>
        {% endfor %}
    {% endif %}
    <tr class="mailboxfooter">
      <td colspan="2">
        <form name="newMessage" action="{{ url_for('.write') }}" method="post">
          <input type="submit" name="del_all" value="{{ _("Write new message") }}" class="formbutton" />
        </form>
      </td>
      <td>&nbsp;</td>
      <td>
        <form name="deleteAll" action="{{ url_for('.delete_all') }}" method="post">
          <input type="submit" name="del_all" value="{{ _("Delete All") }}" class="formbutton" />
        </form>
      </td>
    </tr>
  </tbody>
</table>
{% endblock %}
